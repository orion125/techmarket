SQL> @.\05_trigger_TechMarket.sql
SQL> -- --------------------------------------------------------------------------------------------------------------------------------------------------
SQL> -- Script : 05_trigger_TechMarket.sql
SQL> -- Objet  : Création des triggers BDD TechMarket sur SGBD Oracle en Local (HEGLOCAL)
SQL> --
SQL> -- Auteur : CAPITAO Jonathan
SQL> -- Mise à jour des versions
SQL> -- Version  Visa	Date	   Commentaires
SQL> -- -----  ------  --------    ------------------------------------------------------------------------------------------------------------------------
SQL> -- 1.0	  GA   21.11.15    Création des triggers
SQL> -- ---------------------------------------------------------------------------------------------------------------------------------------------------
SQL> --<ScriptOptions statementTerminator=;/>
SQL> 
SQL> -- Suppression Triggers -------------------------------------------------------------------------------------------------------------------------------
SQL> DROP TRIGGER tr_cha_valider;
DROP TRIGGER tr_cha_valider
*
ERREUR à la ligne 1 :
ORA-04080: déclencheur 'TR_CHA_VALIDER' n'existe pas 


SQL> DROP TRIGGER tr_com_changeStockAtt;
DROP TRIGGER tr_com_changeStockAtt
*
ERREUR à la ligne 1 :
ORA-04080: déclencheur 'TR_COM_CHANGESTOCKATT' n'existe pas 


SQL> 
SQL> -- Création des Triggers ------------------------------------------------------------------------------------------------------------------------------
SQL> CREATE TRIGGER tr_cha_valider
  2    AFTER UPDATE OF cha_etat ON tm_changestockenatt
  3    FOR EACH ROW
  4  DECLARE
  5  	qteto_update number;
  6  BEGIN
  7    IF (:NEW.cha_etat = 0)
  8  	   SELECT cos_nbstockphysique into v_stockphy
  9  	   FROM tm_compoasstock
 10  	   WHERE cos_cmp_id = :new.cha_cos_cmp_id AND cos_emp_id = :new.cha_cos_emp_id;
 11  	   dbms_output.put_line(v_stockphy);
 12  	   qteto_update := :NEW.cha_qte +v_stockphy;
 13  
 14  	   dbms_output.put_line(qteto_update);
 15  	   UPDATE tm_compoasstock SET cos_nbstockphysique = qtetoupdate
 16  	   WHERE cos_cmp_id = :new.cha_cos_cmp_id AND cos_emp_id = :new.cha_cos_emp_id;
 17    END IF;
 18  END;
 19  /

Avertissement : Déclencheur créé avec erreurs de compilation.

SQL> 
SQL> CREATE TRIGGER tr_com_changeStockAtt
  2    AFTER INSERT ON tm_lignecommande
  3  BEGIN
  4  	  IF (:NEW.lco_cmp_id > 0) THEN
  5  		      INSERT INTO tm_changestockenatt (cha_id, cha_commentaire, cha_qte, cha_etat,cmp_id) )VALUES
  6  		      (cha_id_seq.nextval,'Commande n°' || :NEW.lco_com_id, :NEW.lco_qte , 1, :NEW.lco_cmp_id)
  7  	  ELSE
  8  	   RAISE no_cmp_found;
  9  	     CLOSE cur_get_ligncom;
 10  	  END IF;
 11  EXCEPTION
 12  	 WHEN no_cmp_found THEN
 13  	    RAISE_APPLICATION_ERROR(-20111, 'Erreur : aucun article attaché à la commande..');
 14  	 WHEN OTHERS THEN
 15  	    RAISE_APPLICATION_ERROR(-20122, 'Erreur non-supportée pour la commande :' || TO_CHAR(:NEW.com_id));
 16  END;
 17  /
     IF (:NEW.lco_cmp_id > 0) THEN
      *
ERREUR à la ligne 4 :
ORA-04082: références NEW ou OLD interdites dans déclencheurs niveau table 


SQL> SPOOL OFF
