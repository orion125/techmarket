SQL> @.\02_security_TechMarket.sql
SQL> -- -----------------------------------------------------------------------------------------------------------------------------------------------
SQL> -- Script : 02_security_TechMarket.sql
SQL> -- Objet  : Création des utilisateurs BDD TechMarket sur SGBD Oracle en Local (HEGLOCAL)
SQL> --
SQL> -- Auteur : CAPITAO Jonathan
SQL> -- Mise à jour des versions
SQL> -- Version  Visa	Date	   Commentaires
SQL> -- -----  ------  --------    ---------------------------------------------------------------------------------------------------------------------
SQL> -- 1.0	  GA   18.11.15    Création utilisateurs
SQL> -- ------------------------------------------------------------------------------------------------------------------------------------------------
SQL> 
SQL> 
SQL> -- Suppression des rôles, utilisateurs et profil --------------------------------------------------------------------------------------------------
SQL> 
SQL> -- Suppression des utilisateurs
SQL> DROP USER TechMarket_data CASCADE;
DROP USER TechMarket_data CASCADE
*
ERREUR à la ligne 1 :
ORA-01940: impossible de supprimer un utilisateur qui est connecté 


SQL> DROP USER TechMarket_user CASCADE;

Utilisateur supprimé.

SQL> 
SQL> -- Suppression des rôles
SQL> DROP ROLE role_TechMarket_data CASCADE;

Rôle supprimé.

SQL> DROP ROLE role_TechMarket_user CASCADE;

Rôle supprimé.

SQL> 
SQL> -- Suppression du profil
SQL> DROP PROFILE TechMarket_profil;
DROP PROFILE TechMarket_profil
*
ERREUR à la ligne 1 :
ORA-02382: Le profil TECHMARKET_PROFIL a des utilisateurs, impossible d'effectuer la suppression sans CASCADE 


SQL> 
SQL> -- Création du profil TechMarket_profil -------------------------------------------------------------------------------------------------------------
SQL> CREATE PROFILE TechMarket_profil LIMIT
  2  	     SESSIONS_PER_USER 3
  3  	     FAILED_LOGIN_ATTEMPTS 3
  4  	     PASSWORD_LOCK_TIME 1/24
  5  	     PASSWORD_LIFE_TIME 180
  6  	     PASSWORD_REUSE_TIME 180
  7  	     PASSWORD_REUSE_MAX UNLIMITED
  8  	     PASSWORD_GRACE_TIME 7;
CREATE PROFILE TechMarket_profil LIMIT
*
ERREUR à la ligne 1 :
ORA-02379: le profil TECHMARKET_PROFIL existe déjà 


SQL> 
SQL> -- Création du rôle role_TechMarket_data (rôle de l'utilisateur propriétaire des objets de la base) -------------------------------------------------
SQL> 
SQL> -- Creation du rôle role_TechMarket_data
SQL> CREATE ROLE role_TechMarket_data;

Rôle créé.

SQL> 
SQL> -- droit de se connecter à la BDD
SQL> GRANT CONNECT TO role_TechMarket_data;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- droit de créer des triggers, séquence, tables, packages, ...
SQL> GRANT RESOURCE TO role_TechMarket_data;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- droit de créer des vues
SQL> GRANT CREATE VIEW TO role_TechMarket_data;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- droit de créer des synonymes
SQL> -- GRANT CREATE ANY SYNONYM TO role_TechMarket_data;
SQL> -- ! fonctionne mais donne trop de privilèges, à éviter
SQL> 
SQL> -- Création du rôle role_TechMarket_user (rôle de l'utilisateur de l'application) -------------------------------------------------------------------
SQL> 
SQL> -- Creation du rôle role_TechMarket_user
SQL> CREATE ROLE role_TechMarket_user;

Rôle créé.

SQL> 
SQL> -- droit de se connecter à la BDD
SQL> GRANT CREATE SESSION TO role_TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- ---------------------------------------------------------------------------------------------
SQL> -- Création de l'utilisateur TechMarket_data (propriétaire des objets de schéma de la base)
SQL> -- ---------------------------------------------------------------------------------------------
SQL> 
SQL> -- Creation de l'utilisateur TechMarket_data
SQL> CREATE USER TechMarket_data
  2  	     PROFILE TechMarket_profil
  3  	     IDENTIFIED BY TechMarket_data
  4  	     DEFAULT TABLESPACE USERS
  5  	     TEMPORARY TABLESPACE TEMP
  6  ;
CREATE USER TechMarket_data
            *
ERREUR à la ligne 1 :
ORA-01920: nom utilisateur 'TECHMARKET_DATA' en conflit avec autre nom utilisateur ou de rôle 


SQL> GRANT role_TechMarket_data TO TechMarket_data;

Autorisation de privilèges (GRANT) acceptée.

SQL> ALTER USER TechMarket_data quota unlimited ON USERS;

Utilisateur modifié.

SQL> 
SQL> -- ---------------------------------------------------------------------------------------------
SQL> -- Création de l'utilisateur TechMarket_user (utilisateur de l'application)
SQL> -- ---------------------------------------------------------------------------------------------
SQL> CREATE USER TechMarket_user
  2  	     PROFILE TechMarket_profil
  3  	     IDENTIFIED BY TechMarket_user
  4  ;

Utilisateur créé.

SQL> GRANT role_TechMarket_user TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> COMMIT;

Validation effectuée.

SQL> SPOOL OFF
