SQL> @.\06_vues_TechMarket.sql
SQL> -- --------------------------------------------------------------------------------------------------------------------------------------------------
SQL> -- Script: 06_vues_TechMarket.sql
SQL> -- Objet : Création des vues schéma de la base TechMarket
SQL> -- Objectif : créer des vues et tester l'interrogation et la mise-à-jour à travers ces vues.
SQL> --
SQL> -- Auteur : CAPITAO Jonathan
SQL> -- Mise à jour des versions
SQL> -- Version  Visa	Date	   Commentaires
SQL> -- -----  ------  --------    ------------------------------------------------------------------------------------------------------------------------
SQL> -- 1.0	  GA   25.11.15    Création des vues
SQL> -- ---------------------------------------------------------------------------------------------------------------------------------------------------
SQL> --<ScriptOptions statementTerminator=";"/>
SQL> 
SQL> -- Création des VUES ---------------------------------------------------------------------------------------------------------------------------------
SQL> 
SQL> -- Vue d'affichage des fluctuations de stocks
SQL> 
SQL> CREATE OR REPLACE VIEW vw_changstockatt AS
  2  	    SELECT cha_id, cha_comment,cha_etat,cha_qte,cha_datechange,
  3  				     cha_cos_cmp_id, cha_cos_emp_id
  4  	    FROM tm_changestockenatt ;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_changstockatt TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des clients
SQL> 
SQL> CREATE OR REPLACE VIEW vw_client AS
  2  	    SELECT cli_id,cli_nom,cli_prenom, cli_telephone, cli_address,cli_mail
  3  	    FROM tm_client ;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_client TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des commandes
SQL> CREATE OR REPLACE VIEW vw_commande AS
  2  	     SELECT com_id, com_cli_id
  3  	     FROM tm_commande;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_commande TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des relations entre specification et des composants (on lit une valeur à un composant)
SQL> CREATE OR REPLACE VIEW vw_valeur_spec_as_compo AS
  2  	     SELECT cov_spv_id, cov_cmp_id
  3  	     FROM tm_compoasspecvalue;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_valeur_spec_as_compo TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage du stock
SQL> CREATE OR REPLACE VIEW vw_stock AS
  2  	     SELECT cos_nbstockvirtuel, cos_nbstockphysique, cos_emp_id,cos_cmp_id
  3  	     FROM tm_compoasstock;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_stock TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des composants
SQL> CREATE OR REPLACE VIEW vw_composant AS
  2  	     SELECT cmp_id, cmp_nom, cmp_prix, cmp_mar_id, cmp_cot_id
  3  	     FROM tm_composant;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_composant TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des categories de composants
SQL> CREATE OR REPLACE VIEW vw_categorie_compo AS
  2  	     SELECT cot_id, cot_nom
  3  	     FROM tm_composanttype;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_categorie_compo TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des categories concernant chaque marque
SQL> CREATE OR REPLACE VIEW vw_marque_as_categorie AS
  2  	     SELECT ctm_mar_id, ctm_cot_id
  3  	     FROM tm_compotypeasmarque;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_marque_as_categorie TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des categories concernant chaque specification
SQL> CREATE OR REPLACE VIEW vw_spec_as_categorie AS
  2  	     SELECT cts_spc_id, cts_cot_id
  3  	     FROM tm_compotypeasspec;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_spec_as_categorie TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des emplacments dans le stocks (on suppose le hangar ou l'entrepôt ici)
SQL> CREATE OR REPLACE VIEW vw_emplacement AS
  2  	     SELECT emp_id, emp_nom
  3  	     FROM tm_emplacement;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_emplacement TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des composants concernants une commande (et la quantité à laquel il ont été commandé)
SQL> CREATE OR REPLACE VIEW vw_ligne_commande AS
  2  	     SELECT lco_cmp_id, lco_com_id, lco_qte
  3  	     FROM tm_lignecommande;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_ligne_commande TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des utilisateurs ayant droit de se connecter sur la partie manager de l'application
SQL> CREATE OR REPLACE VIEW vw_manager AS
  2  	     SELECT man_id, man_username, man_password
  3  	     FROM tm_manager;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_manager TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des marques
SQL> CREATE OR REPLACE VIEW vw_marque AS
  2  	     SELECT mar_id, mar_nom
  3  	     FROM tm_marque;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_marque TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des valeurs possibles concernant les specifications
SQL> CREATE OR REPLACE VIEW vw_valeur_spec AS
  2  	     SELECT spv_id, spv_spc_id, spv_value
  3  	     FROM tm_specasvalue;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_valeur_spec TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> -- Vue d'affichage des specifications
SQL> CREATE OR REPLACE VIEW vw_spec AS
  2  	     SELECT spc_id, spc_nom
  3  	     FROM tm_specification;

Vue créée.

SQL> GRANT SELECT, INSERT, UPDATE, DELETE ON vw_spec TO TechMarket_user;

Autorisation de privilèges (GRANT) acceptée.

SQL> 
SQL> 
SQL> -- Tester l'interrogation des vues  ------------------------------------------------------------------------------------------------------------------
SQL> 
SQL> -- SELECT * FROM vw_changstockatt;
SQL> -- SELECT * FROM vw_categorie_compo;
SQL> -- SELECT * FROM vw_client;
SQL> -- SELECT * FROM vw_commande;
SQL> -- SELECT * FROM vw_composant;
SQL> -- SELECT * FROM vw_emplacement;
SQL> -- SELECT * FROM vw_ligne_commande;
SQL> -- SELECT * FROM vw_manager;
SQL> -- SELECT * FROM vw_marque;
SQL> -- SELECT * FROM vw_marque_as_categorie;
SQL> -- SELECT * FROM vw_spec;
SQL> -- SELECT * FROM vw_spec_as_categorie;
SQL> -- SELECT * FROM vw_stock;
SQL> -- SELECT * FROM vw_valeur_spec;
SQL> -- SELECT * FROM vw_valeur_spec_as_compo;
SQL> 
SQL> SPOOL OFF
